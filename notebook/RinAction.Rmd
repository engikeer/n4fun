---
title: "R in Action"
output:
  html_notebook: default
  pdf_document: default
---
```{r setup}
library(tidyverse)
```

# 第一部分 入门
## 第1章 R语言介绍
### 1.1 为何要使用R

### 1.2 R的获取和安装

### 1.3 R的使用
#### 1.3.1 新手上路
#### 1.3.2 获取帮助
#### 1.3.3 工作空间
#### 1.3.4 输入和输出

### 1.4 包
#### 1.4.1 什么是包
#### 1.4.2 包的安装
#### 1.4.3 包的载入
#### 1.4.4 包的使用方法

### 1.5 批处理

### 1.6 将输出用为输入：结果的重用

### 1.7 处理大数据集

### 1.8 示例实践

### 1.9 小结

## 第2章 创建数据集
### 2.1 数据集的概念

### 2.2 数据结构
#### 2.2.1 向量
#### 2.2.2 矩阵
#### 2.2.3 数组
#### 2.2.4 数据框
#### 2.2.5 因子
#### 2.2.6 列表

### 2.3 数据的输入
#### 2.3.1 使用键盘输入数据
#### 2.3.2 从带分隔符的文本文件导入数据
#### 2.3.3 导入Excel数据
#### 2.3.4 导入XML数据
#### 2.3.5 从网页抓取数据
#### 2.3.6 导入SPSS数据
#### 2.3.7 导入SAS数据
#### 2.3.8 导入Stata数据
#### 2.3.9 导入NetCDF数据
#### 2.3.10 导入HDF5数据
#### 2.3.11 访问数据库管理系统
#### 2.3.12 通过Stat/Transfer导入数据

### 2.4 数据集的标注
#### 2.4.1 变量标签
#### 2.4.2 值标签

### 2.5 处理数据对象的实用函数

### 2.6 小结

## 第3章 图形初阶
### 3.1 使用图形

### 3.2 一个简单的例子
```{r}
# 示例数据----
dose  <- c(20, 30, 40, 45, 60)
drugA <- c(16, 20, 27, 40, 60)
drugB <- c(15, 18, 25, 31, 40)

plot(dose, drugA, type = "b", lty = 3, pch = 21)

# ggplot----
df <- tibble(
    dose = dose,
    drugA = drugA,
    drugB = drugB
)

ggplot(df, aes(dose, drugA)) +
    geom_line(linetype = 3) +
    geom_point(shape = 21, color = "black", fill = "white") +
    ggtitle("测试用例") +
    theme(plot.title = element_text(family = "PingFangSC-Regular", hjust = 0.5))
    
```

### 3.3 图形参数
#### 3.3.1 符号和线条
#### 3.3.2 颜色
#### 3.3.3 文本属性
#### 3.3.4 图形尺寸与边界尺寸

### 3.4 添加文本、自定义坐标轴和图例
#### 3.4.1 标题
#### 3.4.2 坐标轴
#### 3.4.3 参考线
#### 3.4.4 图例
#### 3.4.5 文本标注
#### 3.4.6 数学标注
```{r plot_element}
dose  <- c(20, 30, 40, 45, 60)
drugA <- c(16, 20, 27, 40, 60)
drugB <- c(15, 18, 25, 31, 40)
df <- tibble(
    dose = dose,
    drugA = drugA,
    drugB = drugB
)

# 原生
plot(dose, drugA, type="b",
     pch=15, lty=1, col="red", ylim=c(0, 60), main="Drug A vs. Drug B",
     xlab="Drug Dosage", ylab="Drug Response")
lines(dose, drugB, type = "b",
      pch = 17, lty = 2, col = "blue")
abline(h = 30, lty = 2, lwd = 1.5, col = "gray")
Hmisc::minor.tick(nx=3, ny=3, tick.ratio=0.5)
legend("topleft", inset=.05, title="Drug Type", c("A","B"),
    lty=c(1, 2), pch=c(15, 17), col=c("red", "blue"))

# ggplot
ggplot(df, aes(dose)) +
    geom_hline(yintercept = 30, size = 3, color = "white") +
    geom_line(aes(y = drugA), linetype = 1, color = "red") +
    geom_point(aes(y = drugA), shape = 15, color = "red") +
    geom_line(aes(y = drugB), linetype = 2, color = "blue") +
    geom_point(aes(y = drugB), shape = 17, color = "blue")

# tidyverse
df <- df %>%
    gather(key = "type", value = "response", drugA:drugB)

ggplot(df, aes(dose, response, color = type)) +
    geom_hline(yintercept = 30, size = 3, color = "white") +
    geom_line(aes(linetype = type)) +
    geom_point(aes(shape = type))
```

### 3.5 图形的组合

### 3.6 小结

## 第4章 基本数据管理
```{r}
# 示例数据
manager <- c(1, 2, 3, 4, 5)
date <- c("10/24/08", "10/28/08", "10/1/08", "10/12/08", "5/1/09")
country <- c("US", "US", "UK", "UK", "UK")
gender <- c("M", "F", "F", "M", "F")
age <- c(32, 45, 25, 39, 99)
q1 <- c(5, 3, 3, 3, 2)
q2 <- c(4, 5, 5, 3, 2)
q3 <- c(5, 2, 5, 4, 1)
q4 <- c(5, 5, 5, NA, 2)
q5 <- c(5, 5, 2, NA, 1)
leadership <- tibble(manager, date, country, gender, age,
                             q1, q2, q3, q4, q5)

# 重编码
# base
within(leadership, {
    agecat <- NA
    agecat[age > 75 & age != 99]  <- "Elder"
    agecat[age >= 55 & age <= 75] <- "Middle Aged"
    agecat[age < 55]              <- "Young" })

# tidyvrese
leadership %>%
    mutate(agecat = case_when(
        age == 99 ~ NA_character_,
        age > 75 ~ "Elder",
        age >= 55 && age <= 75  ~ "Middle Aged",
        age < 55 ~ "Young"
    ))

# 重命名
names(leadership)[6:10] <- paste("item", 1:5, sep = "")
# tidyverse
# rename无法一次重命名多个变量，一次重命名多个变量可使用select
select(leadership, item = 6:10, everything())
```
### 4.1 一个示例

### 4.2 创建新变量

### 4.3 变量的重编码

### 4.4 变量的重命名

### 4.5 缺失值
#### 4.5.1 重编码某些值为缺失值
#### 4.5.2 在分析中排除缺失值

### 4.6 日期值
#### 4.6.1 将日期转换为字符型变量
#### 4.6.2 更进一步

### 4.7 类型转换

### 4.8 数据排序

### 4.9 数据集的合并
#### 4.9.1 向数据框添加列
#### 4.9.2 向数据框添加行

### 4.10 数据集取子集
#### 4.10.1 选入（保留）变量
#### 4.10.2 剔除（丢弃）变量
#### 4.10.3 选入观测
#### 4.10.4 subset()函数
#### 4.10.5 随机抽样

### 4.11 使用SQL语句操作数据框

### 4.12 小结

## 第5章 高级数据管理
### 5.1 一个数据处理难题

### 5.2 数值和字符处理函数
#### 5.2.1 数学函数
#### 5.2.2 统计函数
#### 5.2.3 概率函数
#### 5.2.4 字符处理函数
#### 5.2.5 其他实用函数
#### 将函数应用于矩阵和数据框

### 5.3 数据处理难题的一套解决方案

### 5.4 控制流
#### 5.4.1 重复和循环
#### 5.4.2 条件执行

### 5.5 用户自编函数

### 5.6 整合与重构
#### 5.6.1 转置
#### 5.6.2 整合函数
#### 5.6.3 reshape2包

### 5.7 小结

# 第二部分 基本方法
## 第6章 基本图形
### 6.1 条形图
#### 6.1.1 简单的条形图
#### 6.1.2 堆砌条形图和分组条形图
#### 6.1.3 均值条形图
#### 6.1.4 条形图的微调
#### 6.1.5 棘状图

### 6.2 饼图

### 6.3 直方图

### 6.4 核密度图

### 6.5 箱线图
#### 6.5.1 使用并列箱线图进行跨组比较
#### 6.5.2 小提琴图

### 6.6 点图

### 6.7 小结

## 第7章 基本统计分析
### 7.1 描述性统计分析
#### 7.1.1 方法云集
#### 7.1.2 更多方法
#### 7.1.3 分组计算描述性统计量
```{r}
# 基础安装
aggregate(mtcars[c("mpg", "hp", "wt")],by = list(am=mtcars$am), mean)
# tidyverse
mtcars %>%
    group_by(am) %>%
    summarise(mpg = mean(mpg), hp = mean(hp), wt = mean(wt))
```
#### 7.1.4 分组计算的扩展
#### 7.1.5 结果的可视化

### 7.2 频数表和列联表
#### 7.2.1 生成频数表
#### 7.2.2 独立性检验
#### 7.2.3 相关性的度量
#### 7.2.4 结果的可视化

### 7.3 相关
#### 7.3.1 相关的类型
#### 7.3.2 相关性的显著性检验
#### 7.3.3 相关关系的可视化

### 7.4 t检验
#### 7.4.1 独立样本的t检验
#### 7.4.2 非独立样本的t检验
#### 7.4.3 多于两组的情况

### 7.5 组间差异的非参数检验
#### 7.5.1 两组的比较
#### 7.5.2 多于两组的比较

### 7.6 组间差异的可视化

### 7.7 小结

# 第三部分 中级方法
## 第8章 回归
### 8.1 回归的多面性
#### 8.1.1 OLS回归的适用情境
#### 8.1.2 基础回顾

### 8.2 OLS回归
#### 8.2.1 用lm()拟合回归模型
#### 8.2.2 简单线性回归
#### 8.2.3 多项式回归
#### 8.2.4 多元线性回归
#### 8.2.5 有交互项的多元线性回归

### 8.3 回归诊断
#### 8.3.1 标准方法
#### 8.3.2 改进的方法
#### 8.3.3 线性模型假设的综合验证
#### 8.3.4 多重共线性

### 8.4 异常观测值
#### 8.4.1 离群点
#### 8.4.2 高杠杆值点
#### 8.4.3 强影响点

### 8.5 改进措施
#### 8.5.1 删除观测点
#### 8.5.2 变量变换
#### 8.5.3 增删变量
#### 8.5.4 尝试其他方法

### 8.6 选择“最佳”的回归模型
#### 8.6.1 模型比较
#### 8.6.2 变量选择

### 8.7 深层次分析
#### 8.7.1 交叉验证
#### 8.7.2 相对重要性

### 8.8 小结

## 第9章 方差分析
### 9.1 术语速成

### 9.2 ANOVA模型拟合
#### 9.2.1 aov()函数
#### 9.2.2 表达式中各项的顺序

### 9.3 单因素方差分析
#### 9.3.1 多重比较
#### 9.3.2 评估检验的假设条件

### 9.4 单因素协方差分析
#### 9.4.1 评估检验的假设条件
#### 9.4.2 结果可视化

### 9.5 双因素方差分析

### 9.6 重复测量方差分析

### 9.7 多元方差分析
#### 9.7.1 评估假设检验
#### 9.7.2 稳健多元方差分析

### 9.8 用回归来做ANVOA

### 9.9 小结

## 第10章 功效分析
### 10.1 假设检验速览

### 10.2 用pwr包做功效分析
#### 10.2.1 t检验
#### 10.2.2 方差分析
#### 10.2.3 相关性
#### 10.2.4 线性模型
#### 10.2.5 比例检验
#### 10.2.6 卡方检验
#### 10.2.7 在新情况中选择合适的效应值

### 10.3 绘制功效分析图形

### 10.4 其他软件包

### 10.5 小结

## 第11章 中级绘图
### 11.1 散点图
#### 11.1.1 散点图矩阵
#### 11.1.2 高密度散点图
#### 11.1.3 三维散点图
#### 11.1.4 旋转三维散点图
#### 11.1.5 气泡图

### 11.2 折线图

### 11.3 相关图

### 11.4 马赛克图

### 11.5 小结

## 第12章 重抽样与自助法
### 12.1 置换检验

### 12.2 用coin包做置换检验
#### 12.2.1 独立两样本和K样本检验
#### 12.2.2 列联表中的独立性
#### 12.2.3 数值变量间的独立性
#### 12.2.4 两样本和K样本相关性检验
#### 12.2.5 深入探究

### 12.3 lmPerm包的置换检验
#### 12.3.1 简单回归和多项式回归
#### 12.3.2 多元回归
#### 12.3.3 单因素方差分析和协方差分析
#### 12.3.4 双因素方差分析

### 12.4 置换检验点评

### 12.5 自助法

### 12.6 boot包中的自助法
#### 12.6.1 对单个统计量使用自助法
#### 12.6.2 多个统计量的自助法

### 12.7 小结

# 第四部分 高级方法
## 第13章 广义线性模型
### 13.1 广义线性模型和glm()函数
#### 13.1.1 glm()函数
#### 13.1.2 连用的函数
#### 13.1.3 模型拟合和回归诊断

### 13.2 Logistic回归
#### 13.2.1 解释模型参数
#### 13.2.2 评价预测变量对结果概率的影响
#### 13.2.3 过度离势
#### 13.2.4 扩展

### 13.3 泊松回归
#### 13.3.1 解释模型参数
#### 13.3.2 过度离势
#### 13.3.3 扩展

### 13.4 小结

## 第14章 主成分分析和因子分析
### 14.1 R中的主成分和因子分析

### 14.2 主成分分析
#### 14.2.1 判断主成分的个数
#### 14.2.2 提取主成分
#### 14.2.3 主成分旋转
#### 14.2.4 获取主成分得分

### 14.3 探索性因子分析
#### 14.3.1 判断需提取的公共因子数
#### 14.3.2 提取公共因子
#### 14.3.3 因子旋转
#### 14.3.4 因子得分
#### 14.3.5 其他与EFA相关的包

### 14.4 其他潜变量模型

### 14.5 小结

## 第15章 时间序列
### 15.1 在R中生成时序对象

### 15.2 时序的平滑化和季节性分解
#### 15.2.1 通过简单移动平均进行平滑处理
#### 15.2.2 季节性分解

### 15.3 指数预测模型
#### 15.3.1 单指数平滑
#### 15.3.2 Holt指数平滑和Holt-Winters指数平滑
#### 15.3.3 ets()函数和自动预测

### 15.4 ARIMA预测模型
#### 15.4.1 概念介绍
#### 15.4.2 ARMA和ARIMA模型
#### 15.4.3 ARIMA的自动预测

### 15.5 延伸阅读

### 15.6 小结

## 第16章 聚类分析
### 16.1 聚类分析的一般步骤

### 16.2 计算距离

### 16.3 层次聚类分析

### 16.4 划分聚类分析
#### 16.4.1 K均值聚类
#### 16.4.2 围绕中心点的划分

### 16.5 避免不存在的类

### 16.6 小结

## 第17章 分类
### 17.1 数据准备

### 17.2 逻辑回归

### 17.3 决策树
#### 17.3.1 经典决策树
#### 17.3.2 条件判断树

### 17.4 随机森林

### 17.5 支持向量机

### 17.6 选择预测效果最好的解

### 17.7 用rattle包进行数据挖掘

### 17.8 小结

## 第18章 处理缺失数据的高级方法
### 18.1 处理缺失值的步骤

### 18.2 识别缺失值

### 18.3 探索缺失值模式
#### 18.3.1 列表显示缺失值
#### 18.3.2 图形探究缺失数据
#### 18.3.3 用相关性探索缺失值

### 18.4 理解缺失数据的来由和影响

### 18.5 理性处理不完整数据

### 18.6 完整实例分析（行删除）

### 18.7 多重插补

### 18.8 处理缺失值的其他方法
#### 18.8.1 成对删除
#### 18.8.2 简单（非随机）插补

### 18.9 小结

# 第五部分 技能扩展
## 第19章 使用ggplot2进行高级绘图
### 19.1 R中的四种图形系统

### 19.2 ggplot2包介绍

### 19.3 用几何函数指定图形的类型

### 19.4 分组

### 19.5 刻面

### 19.6 添加光滑曲线

### 19.7 修改ggplot2图形的外观
#### 19.7.1 坐标轴
#### 19.7.2 图例
#### 19.7.3 标尺
#### 19.7.4 主题
#### 19.7.5 多重图

### 19.8 保存图形

### 19.9 小结

## 第20章 高级变成
### 20.1 R语言回顾
#### 20.1.1 数据类型
#### 20.1.2 控制结构
#### 20.1.3 创建函数

### 20.2 环境

### 20.3 面向对象的编程
#### 20.3.1 范型函数
#### 20.3.2 S3模型的限制

### 20.4 编写有效的代码

### 20.5 调试
#### 20.5.1 常见的错误来源
#### 20.5.2 调试工具
#### 20.5.3 支持调试的会话选项

### 20.6 深入学习

### 20.7 小结

## 第21章 创建包
### 21.1 非参分析和npar包
### 21.2 开发包
#### 21.2.1 计算统计量
#### 21.2.2 打印结果
#### 21.2.3 汇总结果
#### 21.2.4 绘制结果
#### 21.2.5 添加样本数据到包

### 21.3 创建包的文档

### 21.4 建立包

### 21.5 深入学习

### 21.6 小结

## 第22章 创建动态报告
### 22.1 用模板生成报告

### 22.2 用R和Markdown创建动态报告

### 22.3 用R和LaTeX创建动态报告

### 22.4 用R和Open Document创建动态报告

### 22.5 用R和Microsoft Word创建动态报告

### 22.6 小结

## 第23章 使用lattice进行高级绘图
### 23.1 lattice包

### 23.2 调节变量

### 23.3 面板函数

### 23.4 分组变量

### 23.5 图形参数

### 23.6 自定义图形条带

### 23.7 页面布局

### 23.8 深入学习

# 附录A 图形用户界面

# 附录B 自定义启动环境

# 附录C 从R中导出数据

# 附录D R中的矩阵运算

# 附录E 本书中用到的扩展包

# 附录F 处理大数据集

# 附录G 更新R

# 后记：探索R的世界

# 参考文献